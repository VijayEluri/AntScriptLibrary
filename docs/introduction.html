<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
    <title>Ant Script Library - Introduction</title>
    <link rel="stylesheet" type="text/css" href="styles/asl.css"/>
    <link href="ant-logo.ico" type="image/x-icon" rel="shortcut icon"/>
</head>
<body>
<div id="wrap">
<div id="header">
    <p class="antlogo"><img src="ant-logo.gif"/></p>
    <h1>Ant Script Library - Introduction</h1>
</div>
<div id="content">
    <h2>Introduction to the Ant Script Library</h2>

    <p>This article is about learning to build your software using
    <a href="http://ant.apache.org/">Ant</a>. Writing a new
    <code>build.xml</code> file from scratch can be difficult, especially
    if you are not very familiar with Ant. To make this easier, I have written
    some reuseable libraries that I will show in my examples below. The
    libraries are free and you can find documentation and a downloadable zip from
    the website at <a href="http://www.exubero.com/asl/">http://www.exubero.com/asl/</a>.</p>

    <h3>Example Project: Deep Thought</h3>
    
    <p>For the purposes of this example, suppose you are developing code for an
    <acronym title="Aritficial Intelligence">AI</acronym> project called Deep
    Thought. You've been developing the code in an
    <acronym title="Integrated Development Environment">IDE</acronym>, but are
    now looking build the code using Ant.</p>
    
    <p>The project structure currently looks like this:</p>
    
    <pre>%<strong>tree</strong>
.
`-- src
    `-- example
        `-- DeepThought.java</pre>
    
    <h4>Install the Ant Script Library</h4>
    
    <p>The first thing to do is grab a copy of the Ant Script Library, which
    can be retrieved from <a href="http://www.exubero.com/asl/download.html">http://www.exubero.com/asl/download.html</a>.
    Download and unzip the file into a subdirectory of your project.</p>
    
    <h4>Build the Code</h4>
    
    <p>Create a new file called <code>build.xml</code> in the top level directory
    of the project, with the following contents:</p>
    
    <pre><code><b>&lt;project</b><span style='color: #008000'> name=</span><span style='color: #aa0000'>"DeepThought"</span><span style='color: #008000'> default=</span><span style='color: #aa0000'>"dist"</span><b>&gt;</b>
    <b>&lt;property</b><span style='color: #008000'> name=</span><span style='color: #aa0000'>"java-build.src-dir"</span><span style='color: #008000'> location=</span><span style='color: #aa0000'>"src"</span><b>/&gt;</b>
    <b>&lt;import</b><span style='color: #008000'> file=</span><span style='color: #aa0000'>"ant-script-library/asl-java-build.xml"</span><b>/&gt;</b>
<b>&lt;/project&gt;</b></code></pre>
    
    <p>Because the directory containing the source code is not exactly as
    expected by the Ant Script Library, we have to override the
    default location by setting the property <code>java-build.src-dir</code>
    before importing the Java build module from the Ant Script Library. The
    line <code>&lt;import file="ant-script-library/asl-java-build.xml"/&gt;</code>
    does the work of making all the build targets available to your script.</p>
    
    <p>The project structure now looks like this:</p>
    
    <pre>%<strong>tree</strong>
.
|-- build.xml
|-- ant-script-library
|   |-- asl-java-build.xml
|   `-- asl-java-test.xml
`-- src
    `-- example
        `-- DeepThought.java</pre>     
    
    <p>With only four lines of Ant build, what can our script do? Looking at
    the project help is a good first place to look:</p>
    
    <pre>%<strong>ant -p</strong>
Buildfile: build.xml

Main targets:

 clean           Deletes files generated by the build
 compile         Compiles the java source
 copy-resources  Copies resources in preparation to be packaged in jar
 dist            Create a distributable for this java project
 generate        Generates source code
 jar             Create a jar for this java project
Default target: dist</pre>

    <p>Not bad! We can compile the code, and package the compiled code into a
    jar file. The default <code>dist</code> target does all this:</p>
    
    <pre>%<strong>ant dist</strong>
Buildfile: build.xml

generate:

-init-classpath:

compile:
    [mkdir] Created dir: /workspace/deepthought/target/classes
    [javac] Compiling 1 source file to /workspace/deepthought/target/classes

copy-resources:

-init-time:

-init-jar-classpath:

jar:
    [mkdir] Created dir: /workspace/deepthought/target/dist
      [jar] Building jar: /workspace/deepthought/target/dist/DeepThought.jar

dist:

BUILD SUCCESSFUL
Total time: 1 second</pre>

    <p>From the <code>BUILD SUCCESSFUL</code> message, we can see that the build
    worked. All files created by the build are put into a subdirectory called
    <code>target</code>. This includes generated class files, and any other
    artifact from the build. The file we can distribute to users of our application
    has been created in <code>target/dist/DeepThought.jar</code>.</p>
    
    <h4>Test the Code</h4>
    
    <p>Now that the distributable <code>jar</code> file has been created, we can
    run some unit tests against it. In this case we'll be using
    <a href="http://www.junit.org">JUnit</a>. It's good practice to put unit
    tests in a parallel directory structure to the source code. With this in mind,
    we can create a test case in the file <code>test/example/DeepThoughtTest.java</code>.
    We will also need a copy of the <code>junit.jar</code> library. If we put this
    in a directory called "<code>lib</code>", it will be automatically picked
    up by the build. This gives us a directory layout like this:</p>
    
    <pre>%<strong>tree</strong>
.
|-- build.xml
|-- ant-script-library
|   |-- asl-java-build.xml
|   `-- asl-java-test.xml
|-- lib
|   `-- junit.jar
|-- src
|   `-- example
|       `-- DeepThought.java
`-- test
    `-- example
        `-- DeepThoughtTest.java</pre>
        
    <p>There's one final change: we need to tell our <code>build.xml</code> that
    it needs to import the testing targets from the library file
    <code>asl-java-test.xml</code>. Edit <code>build.xml</code> so that it
    looks like this:</p>
    
    <pre><code><b>&lt;project</b><span style='color: #008000'> name=</span><span style='color: #aa0000'>"DeepThought"</span><span style='color: #008000'> default=</span><span style='color: #aa0000'>"dist"</span><b>&gt;</b>
    <b>&lt;property</b><span style='color: #008000'> name=</span><span style='color: #aa0000'>"java-build.src-dir"</span><span style='color: #008000'> location=</span><span style='color: #aa0000'>"src"</span><b>/&gt;</b>
    <b>&lt;property</b><span style='color: #008000'> name=</span><span style='color: #aa0000'>"java-test.src-dir"</span><span style='color: #008000'> location=</span><span style='color: #aa0000'>"test"</span><b>/&gt;</b>
    <b>&lt;import</b><span style='color: #008000'> file=</span><span style='color: #aa0000'>"ant-script-library/asl-java-build.xml"</span><b>/&gt;</b>
    <b>&lt;import</b><span style='color: #008000'> file=</span><span style='color: #aa0000'>"ant-script-library/asl-java-test.xml"</span><b>/&gt;</b>
<b>&lt;/project&gt;</b></code></pre>

    <p>With this change, there are now a number of new test related targets
    available from our build:</p>
    
    <pre>%<strong>ant -p</strong>
Buildfile: build.xml

Main targets:

 clean                 Deletes files generated by the build
 compile               Compiles the java source
 copy-resources        Copies resources in preparation to be packaged in jar
 dist                  Create a distributable for this java project
 generate              Generates source code
 jar                   Create a jar for this java project
 test-all              Runs all tests
 test-integration      Runs integration tests
 test-run-integration  Runs the integration tests
 test-run-unit         Runs the unit tests
 test-unit             Runs unit tests
Default target: dist</pre>

    <p>The <code>test-all</code> target looks like a good candidate. Here's how
    to run that target from the command line:</p>
    
    <pre>%<strong>ant test-all</strong>
(output truncated)

-test-init-classpath:

-test-compile:
    [mkdir] Created dir: /workspace/deepthought/deepthought/target/test-classes
    [javac] Compiling 1 source file to /workspace/deepthought/deepthought/target/test-classes

-test-copy-resources:

-test-init-cobertura:

-test-instrument:
[cobertura-instrument] Cobertura 1.9 - GNU GPL License (NO WARRANTY) - See COPYRIGHT file
[cobertura-instrument] Instrumenting 1 file to /workspace/deepthought/deepthought/target/instrumented-classes
[cobertura-instrument] Cobertura: Saved information on 1 classes.
[cobertura-instrument] Instrument time: 149ms

-test-prepare:

-test-init-fileset-unit:

test-run-unit:
    [mkdir] Created dir: /workspace/deepthought/deepthought/target/test-data
    [junit] Testsuite: example.DeepThoughtTest
    [junit] Tests run: 1, Failures: 0, Errors: 0, Time elapsed: 0.157 sec
    [junit] 
    [junit] Cobertura: Loaded information on 1 classes.
    [junit] Cobertura: Saved information on 1 classes.

-test-init-fileset-integration:

test-run-integration:

test-all:

BUILD SUCCESSFUL
Total time: 5 seconds</pre>

    <p>There's a lot more output this time. However, the final message from
    Ant is <code>BUILD SUCCESSFUL</code>, and we can see earlier in the output
    that our tests were run successfully:</p>

    <pre>[junit] Testsuite: example.DeepThoughtTest
[junit] Tests run: 1, <strong>Failures: 0, Errors: 0</strong>, Time elapsed: 0.157 sec</pre>

    <p>That's it! We have a complete compile, package and test build up and
    running, with only a relatively small <code>build.xml</code> and the Ant
    Script Library. The <code>build.xml</code> could have been smaller again
    if we had followed the expected directory layout, and so we would not have
    to explicitly define the <code>src</code> and <code>test</code> directories.</p>

    <p>The Ant Script Library has many more features than shown here, including
    reporting on code metrics, dependency management, <acronym title="Source Code Management">SCM</acronym>
    integration and software release targets. Refer to the documentation at
    <a href="http://www.exubero.com/asl/">http://www.exubero.com/asl/</a> for
    more details.</p>

    <hr/>

    <p>Is there a problem or mistake on this page? Do you want to contribute
    some changes? Send me an email at
    &#106;&#111;&#101;&#64;&#101;&#120;&#117;&#98;&#101;&#114;&#111;&#46;&#99;&#111;&#109;.</p>

</div>
<ul id="nav">
    <li><a href="index.html">Overview</a></li>
    <li><a href="usage.html">Usage</a></li>
    <li><a href="download.html">Download</a></li>
    <li class="navselected">Introduction</li>
    <li><a href="design.html">Design Principles</a></li>
    <li><a href="targets.html">Targets</a></li>
    <li><a href="reference.html">Reference</a></li>
</ul>
<div id="sidebar">
    <h3>Other Ant Resources</h3>
    <ul>
        <li><a href="http://ant.apache.org/">Apache Ant Home</a></li>
        <li><a href="http://ant.apache.org/manual/index.html">Apache Ant Manual</a></li>
        <li><a href="http://www.exubero.com/ant/antintro-s5.html">Introduction to Ant</a></li>
    </ul>
</div>
<div id="footer">
    <p class="updated">Last update: $Date$</p>
    <p class="copyright">Copyright &copy; 2009 <a href="http://www.exubero.com/joe/">Joe Schmetzer</a></p>
    <p class="license">Software is Licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0.html">Apache License, Version 2.0</a></p>
</div>
</div>
</body>
</html>
